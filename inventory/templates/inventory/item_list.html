{% extends 'inventory/base.html' %}
{% block title %}Items{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h3 class="m-0">Items</h3>
  <a class="btn btn-success" href="{% url 'item_create' %}">+ Add Item</a>
</div>

<form class="row gy-2 gx-2 align-items-end mb-3" method="get">
  <div class="col-md-5">
    <label class="form-label">Search (Name or SKU)</label>
    <input type="text" class="form-control" name="q" value="{{ q }}">
  </div>
  <div class="col-md-4">
    <label class="form-label">Category</label>
    <select class="form-select" name="cat">
      <option value="">All</option>
      {% for c in categories %}
        <option value="{{ c.id }}" {% if cat|add:'' == c.id|add:'' %}selected{% endif %}>{{ c.name }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-3">
    <button class="btn btn-outline-primary w-100" type="submit">Filter</button>
  </div>
</form>

<div class="row mb-3">
  <div class="col-md-6">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="d-flex justify-content-between">
          <div><strong>Total Quantity</strong></div>
          <div>{{ total_qty }}</div>
        </div>
        <div class="d-flex justify-content-between mt-2">
          <div><strong>Total Stock Value</strong></div>
          <div>₱ {{ total_value }}</div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="table-responsive">
  <table class="table table-striped table-hover align-middle">
    <thead class="table-dark">
      <tr>
        <th>#</th>
        <th>Image</th>
        <th>Name</th>
        <th>SKU</th>
        <th>Category</th>
        <th class="text-end">Qty</th>
        <th class="text-end">Price</th>
        <th class="text-end">Value</th>
        <th>Updated</th>
        <th style="width:150px">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for item in page_obj %}
      <tr>
        <td>{{ forloop.counter0|add:page_obj.start_index }}</td>
        <td>
          {% if item.image %}
            <img src="{{ item.image.url }}" alt="{{ item.name }}" style="height:40px;width:40px;object-fit:cover;border-radius:6px;">
          {% else %}
            <span class="text-muted">—</span>
          {% endif %}
        </td>
        <td>{{ item.name }}</td>
        <td><span class="badge text-bg-secondary">{{ item.sku }}</span></td>
        <td>
          {% if item.category %}
            <span class="badge text-bg-info">{{ item.category.name }}</span>
          {% else %}
            <span class="text-muted">None</span>
          {% endif %}
        </td>
        <td class="text-end">{{ item.quantity }}</td>
        <td class="text-end">₱ {{ item.price }}</td>
        <td class="text-end">₱ {{ item.value }}</td>
        <td>{{ item.updated_at|date:"Y-m-d H:i" }}</td>
        <td class="text-nowrap">
          <a class="btn btn-sm btn-primary" href="{% url 'item_update' item.pk %}">Edit</a>
          <a class="btn btn-sm btn-outline-danger" href="{% url 'item_delete' item.pk %}">Delete</a>
        </td>
      </tr>
      {% empty %}
        <tr><td colspan="10" class="text-center text-muted py-4">No items found.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% if page_obj.has_other_pages %}
<nav>
  <ul class="pagination">
    {% if page_obj.has_previous %}
      <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}&q={{ q }}&cat={{ cat }}">Previous</a></li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">Previous</span></li>
    {% endif %}
    <li class="page-item disabled"><span class="page-link">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span></li>
    {% if page_obj.has_next %}
      <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}&q={{ q }}&cat={{ cat }}">Next</a></li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">Next</span></li>
    {% endif %}
  </ul>
</nav>
{% endif %}
{% endblock %}
